# æ›´æ–°æ—¥å¿— - 2026å¹´1æœˆ3æ—¥

## ğŸ› Bugä¿®å¤

### ä¿®å¤å¤‡ä»½è„šæœ¬æ— æ³•æ£€æµ‹é…ç½®å˜æ›´çš„é—®é¢˜

**é—®é¢˜æè¿°**ï¼š
å¤‡ä»½è„šæœ¬è¿è¡Œåæ€»æ˜¯æ˜¾ç¤º"No configuration changes detected"ï¼Œå³ä½¿ç”¨æˆ·ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼ˆå¦‚OpenClashçš„config.yamlï¼‰ï¼Œè„šæœ¬ä¹Ÿæ— æ³•æ£€æµ‹åˆ°å˜åŒ–ï¼Œå¯¼è‡´2å‘¨æ²¡æœ‰æ–°çš„å¤‡ä»½æ¨é€åˆ°GitHubã€‚

**æ ¹æœ¬åŸå› **ï¼š
1. **Git resetæ—¶æœºé”™è¯¯**ï¼šè„šæœ¬åœ¨æå–æ–°é…ç½®ä¹‹å‰å°±æ‰§è¡Œäº† `git reset --hard origin/master`ï¼Œå¯¼è‡´æœ¬åœ°çš„configsç›®å½•è¢«è¿œç¨‹ç‰ˆæœ¬è¦†ç›–
2. **é¡ºåºé—®é¢˜**ï¼š
   - æ—§é€»è¾‘ï¼šReset â†’ æå–æ–°é…ç½® â†’ æ¯”è¾ƒï¼ˆçœ‹ä¸åˆ°å·®å¼‚ï¼‰
   - åº”è¯¥ï¼šæå–æ–°é…ç½® â†’ æ¯”è¾ƒ â†’ æäº¤ â†’ æ¨é€ â†’ ResetåŒæ­¥

**ä¿®å¤å†…å®¹**ï¼š

1. **è°ƒæ•´Gitæ“ä½œé¡ºåº** ([smart_backup.sh](../scripts/smart_backup.sh#L117-L130))
   - ç§»é™¤åˆå§‹åŒ–é˜¶æ®µçš„ `git reset --hard` å’Œ `git pull`
   - åªåœ¨æ¨é€æˆåŠŸåæ‰æ‰§è¡Œ `git reset --hard origin/master` åŒæ­¥è¿œç¨‹çŠ¶æ€
   - æ·»åŠ æ¨é€å¤±è´¥æ—¶çš„mergeé‡è¯•é€»è¾‘

2. **å¢å¼ºOpenClashé…ç½®å¤‡ä»½** ([smart_backup.sh](../scripts/smart_backup.sh#L157-L164))
   - æ–°å¢å¤‡ä»½ `/etc/openclash/*.yaml` é…ç½®æ–‡ä»¶
   - ç¡®ä¿OpenClashçš„config.yamlç­‰é…ç½®æ–‡ä»¶å˜æ›´èƒ½è¢«æ£€æµ‹åˆ°
   - é…ç½®æ–‡ä»¶å¤‡ä»½åˆ° `openclash/` ç›®å½•

3. **æ”¹è¿›å˜æ›´æ£€æµ‹** ([smart_backup.sh](../scripts/smart_backup.sh#L169-L173))
   - åŒæ—¶æ£€æŸ¥ `configs/` å’Œ `openclash/` ç›®å½•çš„å˜æ›´
   - æ›´æ–°commit messageç”Ÿæˆé€»è¾‘ï¼ŒåŒ…å«openclashæ–‡ä»¶å

**æµ‹è¯•éªŒè¯**ï¼š
- âœ… è¿æ¥å®é™…æ ‘è“æ´¾è®¾å¤‡æµ‹è¯•
- âœ… æ£€æµ‹åˆ°/etc/config/openclashçš„ä¿®æ”¹ï¼ˆ77000 vs 77488 bytesï¼‰
- âœ… æˆåŠŸç”Ÿæˆcommitï¼š"Update: openclash, config.yaml (2026-01-03)"
- âœ… æˆåŠŸæ¨é€åˆ°GitHubä»“åº“

**å½±å“èŒƒå›´**ï¼š
- æ‰€æœ‰ä½¿ç”¨smart_backup.shçš„ç”¨æˆ·
- ç‰¹åˆ«æ˜¯ä½¿ç”¨OpenClashç­‰æ’ä»¶çš„ç”¨æˆ·

## ğŸ“ æ–‡æ¡£æ›´æ–°

### æ›´æ–°å¤‡ä»½è„šæœ¬æ–‡æ¡£
- æ›´æ–°[scripts/README.md](../scripts/README.md)è¯´æ˜æ–‡æ¡£
  - æ˜ç¡®è¯´æ˜è„šæœ¬ç›‘æ§ `/etc/config` å’Œ `/etc/openclash` ä¸¤ä¸ªç›®å½•
  - æ›´æ–°"ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¸å¤‡ä»½"çš„FAQè¯´æ˜
  - æ·»åŠ OpenClashé…ç½®æ”¯æŒçš„è¯´æ˜

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

**ä¿®æ”¹å‰çš„é—®é¢˜ä»£ç **ï¼š
```bash
# æ—§ä»£ç  - é—®é¢˜æ‰€åœ¨
if [ -d "$BACKUP_DIR/.git" ]; then
    cd "$BACKUP_DIR"
    git fetch origin
    git reset --hard origin/"$BRANCH"  # âŒ è¿™é‡Œè¦†ç›–äº†æœ¬åœ°configs
    git pull origin "$BRANCH"
fi
# ç„¶åæå–é…ç½®... ä½†å·²ç»çœ‹ä¸åˆ°å·®å¼‚äº†
```

**ä¿®å¤åçš„ä»£ç **ï¼š
```bash
# æ–°ä»£ç  - æ­£ç¡®æµç¨‹
if [ -d "$BACKUP_DIR/.git" ]; then
    cd "$BACKUP_DIR"
    git config user.name "Router Auto Backup"
    git config user.email "router@local"
    # æ³¨æ„ï¼šè¿™é‡Œä¸resetï¼Œä¿ç•™æœ¬åœ°çŠ¶æ€ä»¥ä¾¿æ£€æµ‹å˜æ›´
fi
# ... æå–é…ç½®ã€æ£€æµ‹å˜æ›´ã€æäº¤ ...
# æ¨é€æˆåŠŸåæ‰åŒæ­¥ï¼š
git push origin "$BRANCH"
git fetch origin
git reset --hard origin/"$BRANCH"  # âœ… ç°åœ¨æ‰åŒæ­¥
```

## ğŸ¯ ç”¨æˆ·å½±å“

**å—ç›Šç”¨æˆ·**ï¼š
- ä¿®æ”¹è¿‡OpenClashé…ç½®ä½†å‘ç°æ²¡æœ‰å¤‡ä»½çš„ç”¨æˆ·
- å‘ç°GitHubä»“åº“é•¿æ—¶é—´æ²¡æœ‰æ›´æ–°çš„ç”¨æˆ·
- éœ€è¦è¿½è¸ªOpenClashé…ç½®å˜æ›´å†å²çš„ç”¨æˆ·

**å¦‚ä½•å‡çº§**ï¼š
```bash
# ä»GitHubè·å–æœ€æ–°è„šæœ¬
cd /tmp
wget https://raw.githubusercontent.com/Ronchy2000/Raspi-ImmortalWrt/master/scripts/smart_backup.sh
# ä¸Šä¼ åˆ°æ ‘è“æ´¾
scp smart_backup.sh root@192.168.1.1:/root/
# æµ‹è¯•è¿è¡Œ
ssh root@192.168.1.1 "/root/smart_backup.sh"
```

---

**Changelogç”±GitHub CopilotååŠ©ç”Ÿæˆ**
